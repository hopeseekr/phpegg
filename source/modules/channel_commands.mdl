$msg_data=explode(" ",$message);

global $my_nick;
$msg_data[0]=trim(strtoupper($msg_data[0]));
$msg_data[1]=trim($msg_data[1]);
$chan=trim($chan);

switch ($msg_data[0])
	{
	case "!KICK":
	
		$nick=$msg_data[1];
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
			{
		fputs($irc_connect, ":$my_nick KICK $chan $nick \n\r");
			}
		break;
	case "!BAN":
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
			{
			$ban=$msg_data[1];
			if ($debug==1)
				{
			echo "this is ban $ban \n";
				}
			
			if (substr($ban,0,1)=="*")
				{
				fputs($irc_connect, ":$my_nick MODE $chan +b $ban \n\r");	
					// checkign for other ppl to kick
					$hold=str_replace("*!","",$ban);
					$hold=str_replace("*","%",$hold);
					$sql="select nick from chan_users where reason is null and chan_name='$chan' and concat(ident,'@',host_mask) like '$hold'";
					
					$result=@mysql_query($sql,$db);
					while($myrow=@mysql_fetch_array($result))
						{
						$nick=$myrow["nick"];
						
						fputs($irc_connect, ":$my_nick KICK $chan $nick \n\r");	
						}
				}
			else
				{ 
				
				$sql="select ident,host_mask from chan_users where reason is null and nick='$ban' and chan_name='$chan'";
				$result=@mysql_query($sql,$db);
				if (mysql_num_rows($result)==0)
					{
					fputs($irc_connect, ":$my_nick PRIVMSG $chan :$ban is not here \n\r");	
					
					}
				else
					{
					$myrow=@mysql_fetch_array($result);
					$ident=$myrow["ident"];
					$ident=str_replace("~","",$ident);
					$host_mask=$myrow["host_mask"];
					
					$myban=make_ban($ident,$host_mask);
					
					fputs($irc_connect, ":$my_nick MODE $chan +b $myban \n\r");	
					fputs($irc_connect, ":$my_nick KICK $chan $ban \n\r");	
					
					
					// checkign for other ppl to kick
					$hold=str_replace("*!","",$myban);
					$hold=str_replace("*","%",$hold);
					$sql="select nick from chan_users where reason is null and chan_name='$chan' and concat(ident,'@',host_mask) like '$hold'";
					
					$result=@mysql_query($sql,$db);
					while($myrow=@mysql_fetch_array($result))
						{
						$nick=$myrow["nick"];
						
						fputs($irc_connect, ":$my_nick KICK $chan $nick \n\r");	
						}
					
					
					
					}	
				
				
				}	
			
			}
			break;
			
	case "!REMBAN";
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
			{
			$ban=$msg_data[1];
			if (substr($ban,0,1)=="*")
				{
				fputs($irc_connect, ":$my_nick MODE  $chan -b $ban \n\r");	
				
				}
			else
				{
				fputs($irc_connect, ":$my_nick PRIVMSG $chan :$ban is not a valid ban mask \n\r");	
				
				}		
			}
		break;			
	case "!TIME";
		$now=date("l F j S, Y, H:i ",time());
		
		$chan=trim($command_data[2]);
		fputs($irc_connect, ":$my_nick PRIVMSG $chan :$now \n\r");	
		break;
	case "!CALC";
		//eval("\$result=  $msg_data[1];");
		//fputs($irc_connect, "PRIVMSG $chan :$msg_data[1] = $result \n\r");	
		break;

	case "!SEEN":   					
		$seen_nick=trim($msg_data[1]);
		if ($debug==1)
				{
		echo "$chan - $seen_nick - $sender_nick \n";
			}
		$chan=trim($command_data[2]);
		notice_seen($irc_connect,$sender_nick,$chan,$seen_nick);
	    	break;	
	case "!LASTSPOKE":
		$seen_nick=trim($msg_data[1]);
		if ($debug==1)
				{
		echo "$chan - $seen_nick - $sender_nick \n";
			}
		$chan=trim($command_data[2]);
		notice_lastspoke($irc_connect,$sender_nick,$chan,$seen_nick);
		
		break; 
	case "!TOPIC":
		$topic=trim(str_replace("!topic","",$message));
		$is_op=op_check($chan,$sender_nick);
		if ($is_op!=1)
			{	
			$is_voice=voice_check($chan,$sender_nick);
			if ($is_voice==1)
				{
				fputs($irc_connect, ":$irc_nick TOPIC $chan  :$topic \n\r");
				}
			}
		else
			{	
			fputs($irc_connect, ":$irc_nick TOPIC $chan  :$topic \n\r");
			}
		break;   
	case "!VOICE":
		
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
		
			{	
			fputs($irc_connect, ":php_egg MODE $chan +v $msg_data[1] \n\r");	
			}
		break;  
	case "!DEVOICE":
		
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
		
			{	
			fputs($irc_connect, ":php_egg MODE $chan -v $msg_data[1] \n\r");	
			}
		break;  
	case "!HELP":
		
			
		fputs($irc_connect, "PRIVMSG $sender_nick :help commands are ?php <fucntions only> ?mysql <command> and ?perl <command>\n\r");	
		
		break;  	
	case "!OP":
		
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
		
			{	
			fputs($irc_connect, ":php_egg MODE $chan +o $msg_data[1] \n\r");	
			}
		break;  
	case "!DEOP":
		
		$is_op=op_check($chan,$sender_nick);
		if ($is_op==1)
		
			{	
			fputs($irc_connect, ":php_egg MODE $chan -o $msg_data[1] \n\r");	
			}
		break;   		 	 	 					
	}